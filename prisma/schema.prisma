generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String             @id
  avatar        String?
  externalId    String?            @unique
  email         String             @unique
  password      String
  status        UserStatus         @default(INACTIVE)
  role          UserRole           @default(CUSTOMER)
  loans         Loan[]
  repayments    Repayment[]
  inventory     InventoryItem[]
  paymentMethod UserPaymentMethod?
  identity      UserIdentity?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
}

model UserIdentity {
  userId      String   @id
  dateOfBirth String
  documents   String[] // passport, statement etc.
  gender      Gender
  firstName   String
  lastName    String
  contact     String   @unique

  residencyAddress String
  stateResidency   String
  nextOfKinName    String
  nextOfKinContact String
  verified         Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model UserPaymentMethod {
  userId        String   @id
  bankName      String
  accountNumber String
  accountName   String
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Loan {
  id String @id

  amount    Decimal @db.Decimal(10, 2)
  repayable Decimal @db.Decimal(10, 2)

  status   LoanStatus   @default(PENDING)
  loanType LoanType     @default(CASH)
  category LoanCategory

  disbursementDate DateTime?
  loanTenure       Int
  extension        Int       @default(0)

  borrower   User        @relation(fields: [borrowerId], references: [id])
  borrowerId String
  repayments Repayment[]
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt

  asset   InventoryItem? @relation(fields: [assetId], references: [id])
  assetId String?
}

model Repayment {
  id     String  @id @default(cuid())
  repaid Decimal @db.Decimal(10, 2)

  amount     Decimal  @db.Decimal(10, 2)
  netPay     Decimal  @db.Decimal(10, 2)
  period     String // e.g., "APRIL 2025"
  periodInDT DateTime
  grade      String
  step       Int
  command    String
  createdAt  DateTime @default(now())

  user   User?   @relation(fields: [userId], references: [externalId])
  userId String?

  loan   Loan   @relation(fields: [loanId], references: [id])
  loanId String
}

model InventoryItem {
  id          String   @id @default(cuid())
  name        String // e.g., "Samsung TV 32'"
  description String?
  category    String // Electronics, Appliances, etc.
  inStock     Int      @default(0)
  threshold   Int      @default(10) // Low-stock alert level
  vendor      User     @relation(fields: [vendorId], references: [id])
  vendorId    String
  price       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  loans       Loan[]
}

enum UserRole {
  ADMIN
  CUSTOMER
  VENDOR
  SUPER_ADMIN
  VIEW_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  FLAGGED
}

enum LoanType {
  CASH
  COMMODITY
}

enum LoanCategory {
  EDUCATION
  PERSONAL
  BUSINESS
  MEDICAL
  RENT
  TRAVEL
  AGRICULTURE
  UTILITIES
  EMERGENCY
  ASSET_PURCHASE
  OTHERS
}

enum LoanStatus {
  PENDING
  APPROVED
  REJECTED
  DISBURSED
  REPAID
}

enum RepaymentMethod {
  CARD
  TRANSFER
  USSD
  WALLET
}

enum RepaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum Gender {
  Female
  Male
}
